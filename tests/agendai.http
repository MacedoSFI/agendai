# =============================================
# AgendAI - Testes de API
# Extensão necessária: REST Client (humao.rest-client)
# Como usar: clique em "Send Request" acima de cada bloco
# =============================================

@baseUrl = http://localhost:3001/api
@token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI0M2I2MTQ3Mi02MzgyLTQ0ZjAtOTE1Ni1jNGM0ZDBkNzAzM2YiLCJpYXQiOjE3NzE2MDc4MTcsImV4cCI6MTc3MjIxMjYxN30.a1uEMxW2ab8ccOIcbzDiq1pRjJotdjEUfLddFVx87TU"

# ──────────────────────────────────────────
# 1. AUTENTICAÇÃO
# ──────────────────────────────────────────

### 1.1 Cadastro de novo usuário
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "João Silva",
  "email": "joao@teste.com",
  "password": "teste12345",
  "phone": "(11) 99999-0000",
  "profession": "Barbearia",
  "business_name": "Barbearia Silva"
}

### 1.2 Login (copie o token retornado e cole em @token acima)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "joao@teste.com",
  "password": "teste12345"
}

### 1.3 Ver perfil do usuário logado
GET {{baseUrl}}/auth/profile
Authorization: Bearer {{token}}

### 1.4 Login com senha errada (deve retornar 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "joao@teste.com",
  "password": "senha_errada"
}

### 1.5 Acessar rota protegida sem token (deve retornar 401)
GET {{baseUrl}}/auth/profile

# ──────────────────────────────────────────
# 2. CLIENTES
# ──────────────────────────────────────────

### 2.1 Criar cliente 1
POST {{baseUrl}}/clients
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Maria Santos",
  "phone": "5511991110001",
  "email": "maria@email.com",
  "notes": "Prefere atendimento pela manhã"
}

### 2.2 Criar cliente 2
POST {{baseUrl}}/clients
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Carlos Oliveira",
  "phone": "5511991110002",
  "email": "carlos@email.com"
}

### 2.3 Criar cliente 3
POST {{baseUrl}}/clients
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Ana Costa",
  "phone": "5511991110003"
}

### 2.4 Listar todos os clientes
GET {{baseUrl}}/clients
Authorization: Bearer {{token}}

### 2.5 Buscar cliente por ID (substitua o ID)
GET {{baseUrl}}/clients/COLE_ID_DO_CLIENTE_AQUI
Authorization: Bearer {{token}}

### 2.6 Atualizar cliente (substitua o ID)
PUT {{baseUrl}}/clients/COLE_ID_DO_CLIENTE_AQUI
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Maria Santos Silva",
  "phone": "5511991110001",
  "email": "maria.nova@email.com",
  "notes": "Prefere atendimento pela manhã. VIP."
}

# ──────────────────────────────────────────
# 3. SERVIÇOS
# ──────────────────────────────────────────

### 3.1 Criar serviço 1
POST {{baseUrl}}/services
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Corte Masculino",
  "description": "Corte completo com tesoura ou máquina",
  "duration_minutes": 45,
  "price": 45.00,
  "color": "#7c6af7"
}

### 3.2 Criar serviço 2
POST {{baseUrl}}/services
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Barba",
  "description": "Barba completa com navalha",
  "duration_minutes": 30,
  "price": 30.00,
  "color": "#4fd1c5"
}

### 3.3 Criar serviço 3
POST {{baseUrl}}/services
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Corte + Barba",
  "description": "Combo completo",
  "duration_minutes": 60,
  "price": 70.00,
  "color": "#f6ad55"
}

### 3.4 Listar todos os serviços
GET {{baseUrl}}/services
Authorization: Bearer {{token}}

### 3.5 Atualizar serviço (substitua o ID)
PUT {{baseUrl}}/services/COLE_ID_DO_SERVICO_AQUI
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Corte Masculino Premium",
  "description": "Corte completo com hidratação",
  "duration_minutes": 60,
  "price": 55.00,
  "color": "#7c6af7",
  "active": true
}

# ──────────────────────────────────────────
# 4. AGENDAMENTOS
# ──────────────────────────────────────────

### 4.1 Criar agendamento (substitua client_id e service_id)
POST {{baseUrl}}/appointments
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "client_id": "COLE_ID_DO_CLIENTE_AQUI",
  "service_id": "COLE_ID_DO_SERVICO_AQUI",
  "start_time": "2026-02-25T09:00:00",
  "notes": "Cliente pediu para chegar 5 min antes"
}

### 4.2 Criar agendamento 2
POST {{baseUrl}}/appointments
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "client_id": "COLE_ID_DO_CLIENTE_AQUI",
  "service_id": "COLE_ID_DO_SERVICO_AQUI",
  "start_time": "2026-02-25T11:00:00"
}

### 4.3 Criar agendamento em horário conflitante (deve retornar 409)
POST {{baseUrl}}/appointments
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "client_id": "COLE_ID_DO_CLIENTE_AQUI",
  "service_id": "COLE_ID_DO_SERVICO_AQUI",
  "start_time": "2026-02-25T09:15:00"
}

### 4.4 Listar todos os agendamentos
GET {{baseUrl}}/appointments
Authorization: Bearer {{token}}

### 4.5 Filtrar por status
GET {{baseUrl}}/appointments?status=pending
Authorization: Bearer {{token}}

### 4.6 Filtrar por período
GET {{baseUrl}}/appointments?start=2026-02-01&end=2026-02-28
Authorization: Bearer {{token}}

### 4.7 Confirmar agendamento (substitua o ID)
PATCH {{baseUrl}}/appointments/COLE_ID_AGENDAMENTO_AQUI/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "confirmed"
}

### 4.8 Concluir agendamento (substitua o ID)
PATCH {{baseUrl}}/appointments/COLE_ID_AGENDAMENTO_AQUI/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "completed"
}

### 4.9 Cancelar agendamento (substitua o ID)
PATCH {{baseUrl}}/appointments/COLE_ID_AGENDAMENTO_AQUI/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "cancelled"
}

# ──────────────────────────────────────────
# 5. DASHBOARD E RELATÓRIOS
# ──────────────────────────────────────────

### 5.1 Dashboard (resumo do dia + próximos)
GET {{baseUrl}}/appointments/dashboard
Authorization: Bearer {{token}}

### 5.2 Relatório do mês atual
GET {{baseUrl}}/appointments/report?year=2026&month=2
Authorization: Bearer {{token}}

### 5.3 Histórico de um cliente (substitua o ID)
GET {{baseUrl}}/clients/COLE_ID_DO_CLIENTE_AQUI/history
Authorization: Bearer {{token}}

### 5.4 Health check (sem token)
GET http://localhost:3001/health
